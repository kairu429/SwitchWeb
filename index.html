<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Switch風 Webランチャー</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: linear-gradient(180deg, #2c2c2c, #1a1a1a);
      color: white;
      font-family: "Segoe UI", sans-serif;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .main-area {
      display: flex;
      flex-grow: 1;
      padding: 80px 40px;
      overflow: hidden;
      align-items: center;
      gap: 60px;
    }
    .launcher {
      display: flex;
      gap: 40px;
      overflow: hidden;
      flex-grow: 1;
      align-items: center;
    }
    .app {
      flex-shrink: 0;
      width: 160px;
      height: 160px;
      background: #333;
      border-radius: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
      position: relative;
    }
    .app img {
      width: 96px;
      height: 96px;
      border-radius: 15%;
    }
    .app.focused {
      transform: scale(1.3);
      box-shadow: 0 0 25px rgba(255,255,255,0.6);
      z-index: 10;
    }
    .ui-bar {
      height: 60px;
      background: rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding: 0 20px;
      font-size: 14px;
    }
    .add-url {
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-width: 200px;
    }
    .add-url input {
      padding: 8px;
      border-radius: 8px;
      border: none;
      outline: none;
      font-size: 14px;
    }
    .add-url button {
      padding: 8px;
      border-radius: 8px;
      border: none;
      background: #4a90e2;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
    }
    .add-url button:hover {
      background: #357ab8;
    }
  </style>
</head>
<body>
  <div class="main-area">
    <div class="launcher" id="launcher"></div>
    <div class="add-url">
      <input type="text" id="newUrl" placeholder="URLを追加">
      <button id="addBtn">追加</button>
    </div>
  </div>

  <div class="ui-bar">
    <span id="time"></span>
  </div>

  <script>
    const launcher = document.getElementById("launcher");
    const timeLabel = document.getElementById("time");
    const addBtn = document.getElementById("addBtn");
    const newUrlInput = document.getElementById("newUrl");

    let apps = JSON.parse(localStorage.getItem("apps")) || [
      "https://youtube.com",
      "https://twitter.com",
      "https://github.com",
      "https://netflix.com",
      "https://openai.com",
      "https://amazon.co.jp"
    ];

    let selectedIndex = 0;

    function getFavicon(url) {
      try {
        const domain = new URL(url).hostname;
        return `https://www.google.com/s2/favicons?sz=128&domain=${domain}`;
      } catch {
        return "https://via.placeholder.com/96";
      }
    }

    function renderApps() {
      launcher.innerHTML = "";
      apps.forEach((app, i) => {
        const div = document.createElement("div");
        div.className = "app" + (i === selectedIndex ? " focused" : "");
        div.innerHTML = `<img src="${getFavicon(app)}" alt="icon">`;
        div.onclick = () => window.open(app, "_blank");
        launcher.appendChild(div);
      });
      updateView();
    }

    function updateFocus() {
      const appDivs = document.querySelectorAll(".app");
      appDivs.forEach((el, i) => {
        el.classList.toggle("focused", i === selectedIndex);
      });
    }

    function updateView() {
      const appDivs = document.querySelectorAll(".app");
      if (!appDivs[selectedIndex]) return;
      const selected = appDivs[selectedIndex];

      const offset = selected.offsetLeft - launcher.clientWidth / 3;
      launcher.scrollTo({ left: offset, behavior: "smooth" });
    }

    function moveSelection(dir) {
      selectedIndex += dir;
      if (selectedIndex < 0) selectedIndex = 0;
      if (selectedIndex >= apps.length) selectedIndex = apps.length - 1;
      updateFocus();
      updateView();
    }

    // キーボード操作
    window.addEventListener("keydown", e => {
      if (e.key === "ArrowRight") moveSelection(1);
      if (e.key === "ArrowLeft") moveSelection(-1);
      if (e.key === "Enter") window.open(apps[selectedIndex], "_blank");
    });

    // コントローラー操作（Gamepad API）
    let lastMoveTime = 0;
    function gamepadLoop() {
      const now = performance.now();
      const gamepads = navigator.getGamepads();
      if (gamepads[0]) {
        const gp = gamepads[0];

        if (gp.buttons[15]?.pressed && now - lastMoveTime > 200) {  // →ボタン
          moveSelection(1);
          lastMoveTime = now;
        }
        if (gp.buttons[14]?.pressed && now - lastMoveTime > 200) { // ←ボタン
          moveSelection(-1);
          lastMoveTime = now;
        }
        if (gp.buttons[0]?.pressed) window.open(apps[selectedIndex], "_blank"); // Aボタン
      }
      requestAnimationFrame(gamepadLoop);
    }
    gamepadLoop();

    // 時計
    function updateTime() {
      const now = new Date();
      timeLabel.textContent = now.toLocaleTimeString("ja-JP", { hour: "2-digit", minute: "2-digit" });
    }
    setInterval(updateTime, 1000);
    updateTime();

    // URL追加
    addBtn.onclick = () => {
      const url = newUrlInput.value.trim();
      if (!url) return;
      apps.push(url);
      localStorage.setItem("apps", JSON.stringify(apps));
      newUrlInput.value = "";
      renderApps();
    };

    renderApps();
  </script>
</body>
</html>
