<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Switch風 Webランチャー</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: linear-gradient(180deg, #0d0d0d, #1a1a1a);
      color: white;
      font-family: "Segoe UI", sans-serif;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .launcher {
      display: flex;
      gap: 40px;
      padding: 80px;
      overflow: hidden; /* 手動スクロール禁止 */
      flex-grow: 1;
      align-items: center;
    }
    .app {
      flex-shrink: 0;
      width: 160px;
      height: 160px;
      background: #222;
      border-radius: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
      position: relative;
    }
    .app img {
      width: 96px;
      height: 96px;
      border-radius: 15%;
    }
    .app.focused {
      transform: scale(1.3);
      box-shadow: 0 0 25px rgba(255,255,255,0.6);
      z-index: 10;
    }
    .ui-bar {
      height: 60px;
      background: rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding: 0 20px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="launcher" id="launcher"></div>

  <div class="ui-bar">
    <span id="time"></span>
  </div>

  <script>
    const launcher = document.getElementById("launcher");
    const timeLabel = document.getElementById("time");

    let apps = JSON.parse(localStorage.getItem("apps")) || [
      "https://youtube.com",
      "https://twitter.com",
      "https://github.com",
      "https://netflix.com",
      "https://openai.com",
      "https://amazon.co.jp"
    ];

    let selectedIndex = 0;

    function getFavicon(url) {
      try {
        const domain = new URL(url).hostname;
        return `https://www.google.com/s2/favicons?sz=128&domain=${domain}`;
      } catch {
        return "https://via.placeholder.com/96";
      }
    }

    function renderApps() {
      launcher.innerHTML = "";
      apps.forEach((app, i) => {
        const div = document.createElement("div");
        div.className = "app" + (i === selectedIndex ? " focused" : "");
        div.innerHTML = `<img src="${getFavicon(app)}" alt="icon">`;
        div.onclick = () => window.open(app, "_blank");
        launcher.appendChild(div);
      });
      updateView();
    }

    function updateFocus() {
      const appDivs = document.querySelectorAll(".app");
      appDivs.forEach((el, i) => {
        el.classList.toggle("focused", i === selectedIndex);
      });
    }

    function updateView() {
      const appDivs = document.querySelectorAll(".app");
      if (!appDivs[selectedIndex]) return;

      const selected = appDivs[selectedIndex];
      const launcherRect = launcher.getBoundingClientRect();
      const selectedRect = selected.getBoundingClientRect();

      // 選択中のアイコンが画面左1/3～右2/3に収まるように調整
      const offset = selected.offsetLeft - launcher.clientWidth / 3;
      launcher.scrollTo({
        left: offset,
        behavior: "smooth"
      });
    }

    function moveSelection(dir) {
      selectedIndex = Math.max(0, Math.min(apps.length - 1, selectedIndex + dir));
      updateFocus();
      updateView();
    }

    // キーボード操作（→ ←）
    window.addEventListener("keydown", e => {
      if (e.key === "ArrowRight") moveSelection(1);
      if (e.key === "ArrowLeft") moveSelection(-1);
      if (e.key === "Enter") window.open(apps[selectedIndex], "_blank");
    });

    // コントローラー操作（Gamepad API）
    let gamepadIndex = null;
    function gamepadLoop() {
      const gamepads = navigator.getGamepads();
      if (gamepads[0]) {
        const gp = gamepads[0];
        if (gp.buttons[15]?.pressed) moveSelection(1);  // → ボタン
        if (gp.buttons[14]?.pressed) moveSelection(-1); // ← ボタン
        if (gp.buttons[0]?.pressed) window.open(apps[selectedIndex], "_blank"); // Aボタン
      }
      requestAnimationFrame(gamepadLoop);
    }
    gamepadLoop();

    // 時計
    function updateTime() {
      const now = new Date();
      timeLabel.textContent = now.toLocaleTimeString("ja-JP", { hour: "2-digit", minute: "2-digit" });
    }
    setInterval(updateTime, 1000);
    updateTime();

    renderApps();
  </script>
</body>
</html>
