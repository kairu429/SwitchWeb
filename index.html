<script>
  function render(){
    carousel.innerHTML = '';
    apps.forEach((app, idx)=>{
      const tile = document.createElement('div');
      tile.className = 'tile';
      tile.dataset.idx = idx;

      const img = document.createElement('img');
      img.className = 'icon-img';
      img.src = faviconFor(app.url);
      img.alt = app.name;
      tile.appendChild(img);

      const label = document.createElement('div');
      label.className = 'mini-label';
      label.textContent = app.name;
      tile.appendChild(label);

      carousel.appendChild(tile);
    });

    updateSelection(false);
  }

  function updateSelection(animate=true){
    const tiles = Array.from(carousel.querySelectorAll('.tile'));
    tiles.forEach(t=>t.classList.remove('selected'));
    const selTile = tiles[selected];
    if(selTile){
      selTile.classList.add('selected');
      centerTile(selTile, animate);
    }
  }

  function centerTile(tile, animate){
    const tileRect = tile.getBoundingClientRect();
    const viewportCenter = window.innerWidth / 2;
    const tileCenter = tileRect.left + tileRect.width / 2;
    const delta = viewportCenter - tileCenter;
    currentOffset += delta;
    carousel.style.transition = animate ? 'transform 400ms ease' : 'none';
    carousel.style.transform = `translateX(${currentOffset}px)`;
  }

  function move(dir){
    const max = apps.length - 1;
    let n = selected + dir;
    if(n < 0) n = 0;
    if(n > max) n = max;
    if(n !== selected){
      selected = n;
      updateSelection(true);
    }
  }
</script>
